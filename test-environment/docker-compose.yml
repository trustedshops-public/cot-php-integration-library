services:
  test-environment:
    build:
      context: ..
      dockerfile: test-environment/Dockerfile
    container_name: cot-test-environment
    ports:
      - "8081:8081"
      - "9003:9003"  # Xdebug port
    volumes:
      # Mount test environment for development
      - .:/var/www/html/test-environment
      # Mount source code directly
      - ../src:/var/www/html/src:ro
      - ../vendor:/var/www/html/vendor:ro
    environment:
      - PHP_ENV=development
      - XDEBUG_MODE=debug
    restart: unless-stopped
    networks:
      - cot-test-network

  apache-proxy:
    image: httpd:2.4
    container_name: cot-apache-proxy
    depends_on:
      - test-environment
    ports:
      - "8443:443"
    volumes:
      - ./apache-cot-ssl.conf:/usr/local/apache2/conf/extra/cot-ssl.conf:ro
      - ./certs:/usr/local/apache2/conf/certs:ro
    command: ["httpd-foreground", "-C", "Include conf/extra/cot-ssl.conf"]
    networks:
      - cot-test-network

networks:
  cot-test-network:
    driver: bridge
